<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../lambda2.ico">
        

	<title>Solvers - Laplacians.jl</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <link href="../Laplacians.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../about/index.html">Laplacians.jl</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../about/index.html">About</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">User Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Installation/index.html">Installation</a>
</li>

                        
                            
<li >
    <a href="../Julia/index.html">Using Julia</a>
</li>

                        
                            
<li >
    <a href="../Examples/index.html">Examples</a>
</li>

                        
                            
<li >
    <a href="../CSCgraph/index.html">Sparse matrices as graphs</a>
</li>

                        
                            
<li class="active">
    <a href="index.html">Solvers</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Developing/index.html">Devleoping Laplacians</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../wholeAPI/index.html">Whole API</a>
</li>

                        
                            
<li >
    <a href="../graphGeneratorsAPI/index.html">graphGenerators</a>
</li>

                        
                            
<li >
    <a href="../IOAPI/index.html">IO</a>
</li>

                        
                            
<li >
    <a href="../graphOpsAPI/index.html">graphOps</a>
</li>

                        
                            
<li >
    <a href="../graphAlgsAPI/index.html">graphAlgs</a>
</li>

                        
                            
<li >
    <a href="../graphUtilsAPI/index.html">graphUtils</a>
</li>

                        
                            
<li >
    <a href="../solversAPI/index.html">solvers</a>
</li>

                        
                            
<li >
    <a href="../cutHeuristicsAPI/index.html">cutHeuristics</a>
</li>

                        
                            
<li >
    <a href="../localClusteringAPI/index.html">localClustering</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../CSCgraph/index.html">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Developing/index.html">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/danspielman/Laplacians.jl">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#solving-linear-equations-in-laplacians">Solving linear equations in Laplacians</a></li>
        
            <li><a href="#direct-solvers">Direct Solvers</a></li>
        
            <li><a href="#iterative-solvers">Iterative Solvers</a></li>
        
            <li><a href="#low-stretch-spanning-trees">Low-Stretch Spanning Trees</a></li>
        
            <li><a href="#augmented-spanning-tree-preconditioners">Augmented spanning tree preconditioners</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<div class="toc">
<ul>
<li><a href="#solving-linear-equations-in-laplacians">Solving linear equations in Laplacians</a><ul>
<li><a href="#direct-solvers">Direct Solvers</a></li>
<li><a href="#iterative-solvers">Iterative Solvers</a></li>
<li><a href="#low-stretch-spanning-trees">Low-Stretch Spanning Trees</a></li>
<li><a href="#augmented-spanning-tree-preconditioners">Augmented spanning tree preconditioners</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="solving-linear-equations-in-laplacians">Solving linear equations in Laplacians</h1>
<p>For some experiments with solvers, including some of those below, look at the notebook Solvers.ipynb.</p>
<h2 id="direct-solvers">Direct Solvers</h2>
<p>You can compute a cholesky factor directly with <code>cholfact</code>.  It does  more than just compute the factor, and it saves its result in a data structure that implements <code>\</code>.  It uses SuiteSparse by Tim Davis.</p>
<p>Here is an example of how you would use it to solve a general non-singular linear system.</p>
<pre><code class="julia">a = grid2(5)
la = lap(a)
la[1,1] = la[1,1] + 1
F = cholfact(la)

n = size(a)[1]
b = randn(n)
x = F \ b
norm(la*x-b)

    1.0598778281116327e-14
</code></pre>

<p>Laplacians, however, are singular.  So, we need to wrap the solver inside a routine that compensates for this.</p>
<pre><code class="julia">la = lap(a)
f = lapWrapSolver(cholfact,la)
b = randn(n); b = b - mean(b);
norm(la*f(b) - b)
    2.0971536951312585e-15
</code></pre>

<p>Here are two other ways of using the wrapper:</p>
<pre><code class="julia">lapChol = lapWrapSolver(cholfact)
f = lapChol(la)
b = randn(n);
b = b - mean(b);
norm(la*f(b) - b)
    2.6924696662484416e-15

x = lapWrapSolver(cholfact,la,b)
norm(la*x - b)
    2.6924696662484416e-15
</code></pre>

<h2 id="iterative-solvers">Iterative Solvers</h2>
<p>The first, of course, is the Conjugate Gradient (cg).</p>
<p>Our implementation requires 2 arguments: the matrix and the right-hand vector.  It's optional arguments are the tolerance <code>tol</code> and the maximum number of iterations, <code>maxits</code>.  It has been written to use BLAS when possible, and slower routines when dealing with data types that BLAS cannot handle.  Here are examples.</p>
<pre><code class="julia">n = 50
a = randn(n,n); a = a * a';
b = randn(n)
x = cg(a,b,maxits=100)
norm(a*x - b)
    1.2191649497921835e-6

bbig = convert(Array{BigFloat,1},b)
xbig = cg(a,bbig,maxits=100)
norm(a*xbig - bbig)
    1.494919244242202629856363570306545126541716514824419323325986374186529786019681e-33
</code></pre>

<p>As a sanity check, we do two speed tests against Matlab.</p>
<pre><code class="julia">la = lap(grid2(200))
n = size(la)[1]
b = randn(n)
b = b - mean(b);
@time x = cg(la,b,maxits=1000)
    0.813791 seconds (2.77 k allocations: 211.550 MB, 3.56% gc time)

norm(la*x-b)
    0.0001900620047823064
</code></pre>

<p>And, in Matlab:</p>
<pre><code class="matlab">&gt;&gt; a = grid2(200);
&gt;&gt; la = lap(a);
&gt;&gt; b = randn(length(a),1); b = b - mean(b);
&gt;&gt; tic; x = pcg(la,b,[],1000); toc
pcg converged at iteration 688 to a solution with relative residual 9.8e-07.
Elapsed time is 1.244917 seconds.
&gt;&gt; norm(la*x-b)

ans =

   1.9730e-04
</code></pre>

<p>PCG also takes as input a preconditioner.  This should be a function.  Here is an example of how one might construct and use a diagonal preonditioner.  To motivate this, I will use a grid with highly varying weights on edges.</p>
<pre><code class="julia">a = mapweight(grid2(200),x-&gt;1/(rand(1)[1]));
la = lap(a)
n = size(la)[1]
b = randn(n)
b = b - mean(b);

d = diag(la)
pre(x) = x ./ d
@time x = pcg(la,b,pre,maxits=2000)
    3.322035 seconds (42.21 k allocations: 1.194 GB, 5.11% gc time)
norm(la*x-b)
    0.008508746034886803
</code></pre>

<p>If our target is just low error, and we are willing to allow many iterations, here's how cg and pcg compare on this example.</p>
<pre><code class="julia">@time x = pcg(la,b,pre,tol=1e-1,maxits=10^5)
    0.747042 seconds (9.65 k allocations: 275.819 MB, 4.87% gc time)
norm(la*x-b)
    19.840756251253442

@time x = cg(la,b,tol=1e-1,maxits=10^5)
    6.509665 seconds (22.55 k allocations: 1.680 GB, 3.68% gc time)
norm(la*x-b)
    19.222483530605043
</code></pre>

<h2 id="low-stretch-spanning-trees">Low-Stretch Spanning Trees</h2>
<p>In order to make preconditioners, we will want low-stretch spanning trees.  We do not yet have any code in Julia that is guaranteed to produce these.  Instead, for now, we have two routines that can be thought of as randomized versions of Prim and Kruskall's algorithm.
<code>randishKruskall</code> samples the remaining edges with probability proportional to their weight.  <code>randishPrim</code> samples edges on the boundary while using the same rule.</p>
<p>Both use a data structure called <code>Sampler</code> that allows you to store integers with real values, and to sample according to those real values.</p>
<p>We also have code for computing the stretches.
Here are some examples.</p>
<pre><code class="julia">a = grid2(1000)
t = randishKruskal(a);
st = compStretches(t,a);
sum(st)/nnz(a)
    43.410262262262265

t = randishPrim(a);
st = compStretches(t,a);
sum(st)/nnz(a)
    33.14477077077077

</code></pre>

<h2 id="augmented-spanning-tree-preconditioners">Augmented spanning tree preconditioners</h2>
<p>Here is code that will invoke one.
It is designed for positive definite systems.  So, let's give it one.
Right now, it is using a randomized version of a MST.  There is no real reason to think that this should work.</p>
<pre><code class="julia">a = mapweight(grid2(1000),x-&gt;1/(rand(1)[1]));
la = lap(a)
n = size(la)[1]
la[1,1] = la[1,1] + 1
@time F = augTreeSolver(la,tol=1e-1,maxits=1000)
    6.529052 seconds (4.00 M allocations: 1.858 GB, 15.34% gc time)

b = randn(n)
@time x = F(b)
    29.058915 seconds (9.74 k allocations: 23.209 GB, 6.84% gc time)

norm(la*x - b)
    99.74452367765869

# Now, let's contrast with using CG

@time y = cg(la,b,tol=1e-1,maxits=1000)
    28.719631 seconds (4.01 k allocations: 7.473 GB, 3.74% gc time)

norm(la*y-b)
    3243.6014713600766

</code></pre>

<p>That was not too impressive.  We will have to investigate.  By default, it presently uses randishKruskal.  Let's try randishPrim.  You can pass the treeAlg as a parameter.</p>
<pre><code class="julia">@time F = augTreeSolver(la,tol=1e-1,maxits=1000,treeAlg=randishPrim);
    6.319489 seconds (4.00 M allocations: 2.030 GB, 18.81% gc time)

b = randn(n)
@time x = F(b)
    29.503484 seconds (9.76 k allocations: 23.268 GB, 7.31% gc time)

norm(la*x - b)
    99.29610874176991
</code></pre>

<p>To solve systems in a Laplacian, we could wrap it.</p>
<pre><code class="julia">n = 40000
la = lap(randRegular(n,3))
f = lapWrapSolver(augTreeSolver,la,tol=1e-6,maxits=1000)
b = randn(n); b = b - mean(b)
x = f(b)
norm(la*x-b)
    0.00019304778073388
</code></pre>

<p>As you can see, lapWrapSolver can pass tol and maxits arguments to its solver, if they are given to it.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
        <script src="../mathjaxhelper.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
