<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Solvers - GraphAnalysis.jl</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Solvers";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../yinsGraph/" class="icon icon-home"> GraphAnalysis.jl</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../yinsGraph/">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Solvers</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#solving-linear-equations-in-laplacians">Solving linear equations in Laplacians</a></li>
                
                    <li><a class="toctree-l4" href="#direct-solvers">Direct Solvers</a></li>
                
                    <li><a class="toctree-l4" href="#iterative-solvers">Iterative Solvers</a></li>
                
                    <li><a class="toctree-l4" href="#low-stretch-spanning-trees">Low-Stretch Spanning Trees</a></li>
                
                    <li><a class="toctree-l4" href="#augmented-spanning-tree-preconditioners">Augmented spanning tree preconditioners</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../api/yinsGraph/">API</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../yinsGraph/">GraphAnalysis.jl</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../yinsGraph/">Docs</a> &raquo;</li>
    
      
    
    <li>Solvers</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/danspielman/GraphAnalysis.jl" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <div class="toc">
<ul>
<li><a href="#solving-linear-equations-in-laplacians">Solving linear equations in Laplacians</a><ul>
<li><a href="#direct-solvers">Direct Solvers</a></li>
<li><a href="#iterative-solvers">Iterative Solvers</a></li>
<li><a href="#low-stretch-spanning-trees">Low-Stretch Spanning Trees</a></li>
<li><a href="#augmented-spanning-tree-preconditioners">Augmented spanning tree preconditioners</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="solving-linear-equations-in-laplacians">Solving linear equations in Laplacians</h1>
<p>Right now, our solver code is in <code>solvers.jl</code>, but not included in yinsGraph.  So, you should include this directly.  Implementations of cg and pcg have been automatically included in yinsGraph.  They are in the file <code>pcg.jl</code></p>
<p>For some experiments with solvers, including some of those below, look at the notebook <a href="../Solvers.ipynb">Solvers.ipynb</a>.</p>
<h2 id="direct-solvers">Direct Solvers</h2>
<p>You can compute a cholesky factor directly with <code>cholfact</code>.  It does  more than just compute the factor, and it saves its result in a data structure that implements <code>\</code>.  It uses SuiteSparse by Tim Davis.</p>
<p>Here is an example of how you would use it to solve a general non-singular linear system.</p>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">grid2</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">la</span> <span class="o">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">la</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">cholfact</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">F</span> \ <span class="n">b</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="mf">1.0598778281116327e-14</span>
</pre></div>


<p>Laplacians, however, are singular.  So, we need to wrap the solver inside a routine that compensates for this.</p>
<div class="codehilite"><pre><span class="n">la</span> <span class="o">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">lapWrapSolver</span><span class="p">(</span><span class="n">cholfact</span><span class="p">,</span><span class="n">la</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="mf">2.0971536951312585e-15</span>
</pre></div>


<p>Here are two other ways of using the wrapper:</p>
<div class="codehilite"><pre><span class="n">lapChol</span> <span class="o">=</span> <span class="n">lapWrapSolver</span><span class="p">(</span><span class="n">cholfact</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">lapChol</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> 
<span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="mf">2.6924696662484416e-15</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">lapWrapSolver</span><span class="p">(</span><span class="n">cholfact</span><span class="p">,</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="mf">2.6924696662484416e-15</span>
</pre></div>


<h2 id="iterative-solvers">Iterative Solvers</h2>
<p>The first, of course, is the Conjugate Gradient (cg).</p>
<p>Our implementation requires 2 arguments: the matrix and the right-hand vector.  It's optional arguments are the tolerance <code>tol</code> and the maximum number of iterations, <code>maxits</code>.  It has been written to use BLAS when possible, and slower routines when dealing with data types that BLAS cannot handle.  Here are examples.</p>
<div class="codehilite"><pre><span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span> <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="o">&#39;</span><span class="p">;</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="mf">1.2191649497921835e-6</span>

<span class="n">bbig</span> <span class="o">=</span> <span class="nb">convert</span><span class="p">(</span><span class="n">Array</span><span class="p">{</span><span class="n">BigFloat</span><span class="p">,</span><span class="mi">1</span><span class="p">},</span><span class="n">b</span><span class="p">)</span>
<span class="n">xbig</span> <span class="o">=</span> <span class="n">cg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">bbig</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">xbig</span> <span class="o">-</span> <span class="n">bbig</span><span class="p">)</span>
    <span class="mf">1.494919244242202629856363570306545126541716514824419323325986374186529786019681e-33</span>
</pre></div>


<p>As a sanity check, we do two speed tests against Matlab.</p>
<div class="codehilite"><pre><span class="n">la</span> <span class="o">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">grid2</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">la</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="p">@</span><span class="n">time</span> <span class="n">x</span> <span class="o">=</span> <span class="n">cg</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="mf">0.813791</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">2.77</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">211.550</span> <span class="n">MB</span><span class="p">,</span> <span class="mf">3.56</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>

<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">0.0001900620047823064</span>
</pre></div>


<p>And, in Matlab:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;</span> <span class="n">a</span> <span class="p">=</span> <span class="n">grid2</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">la</span> <span class="p">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">b</span> <span class="p">=</span> <span class="nb">randn</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="mi">1</span><span class="p">);</span> <span class="n">b</span> <span class="p">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">tic</span><span class="p">;</span> <span class="n">x</span> <span class="p">=</span> <span class="n">pcg</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">,[],</span><span class="mi">1000</span><span class="p">);</span> <span class="n">toc</span>
<span class="n">pcg</span> <span class="n">converged</span> <span class="n">at</span> <span class="n">iteration</span> <span class="mi">688</span> <span class="n">to</span> <span class="n">a</span> <span class="n">solution</span> <span class="n">with</span> <span class="n">relative</span> <span class="n">residual</span> <span class="mf">9.8e-07</span><span class="p">.</span>
<span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">1.244917</span> <span class="n">seconds</span><span class="p">.</span>
<span class="o">&gt;&gt;</span> <span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

<span class="nb">ans</span> <span class="p">=</span>

   <span class="mf">1.9730e-04</span>
</pre></div>


<p>PCG also takes as input a preconditioner.  This should be a function.  Here is an example of how one might construct and use a diagonal preonditioner.  To motivate this, I will use a grid with highly varying weights on edges.</p>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">mapweight</span><span class="p">(</span><span class="n">grid2</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span><span class="n">x</span><span class="o">-&gt;</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]));</span>
<span class="n">la</span> <span class="o">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">la</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">diag</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>
<span class="n">pre</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span> <span class="o">./</span> <span class="n">d</span>
<span class="p">@</span><span class="n">time</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pcg</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">pre</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
    <span class="mf">3.322035</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">42.21</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">1.194</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">5.11</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">0.008508746034886803</span>
</pre></div>


<p>If our target is just low error, and we are willing to allow many iterations, here's how cg and pcg compare on this example.</p>
<div class="codehilite"><pre><span class="p">@</span><span class="n">time</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pcg</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">pre</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">10</span><span class="o">^</span><span class="mi">5</span><span class="p">)</span>
    <span class="mf">0.747042</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">9.65</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">275.819</span> <span class="n">MB</span><span class="p">,</span> <span class="mf">4.87</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">19.840756251253442</span>

<span class="p">@</span><span class="n">time</span> <span class="n">x</span> <span class="o">=</span> <span class="n">cg</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">10</span><span class="o">^</span><span class="mi">5</span><span class="p">)</span>
    <span class="mf">6.509665</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">22.55</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">1.680</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">3.68</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">19.222483530605043</span>
</pre></div>


<h2 id="low-stretch-spanning-trees">Low-Stretch Spanning Trees</h2>
<p>In order to make preconditioners, we will want low-stretch spanning trees.  We do not yet have any code in Julia that is guaranteed to produce these.  Instead, for now, we have two routines that can be thought of as randomized versions of Prim and Kruskall's algorithm.
<code>randishKruskall</code> samples the remaining edges with probability proportional to their weight.  <code>randishPrim</code> samples edges on the boundary while using the same rule.</p>
<p>Both use a data structure called <code>Sampler</code> that allows you to store integers with real values, and to sample according to those real values.</p>
<p>We also have code for computing the stretches.
Here are some examples.</p>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">grid2</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">randishKruskal</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">compStretches</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
<span class="n">sum</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="o">/</span><span class="n">nnz</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="mf">43.410262262262265</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">randishPrim</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="n">st</span> <span class="o">=</span> <span class="n">compStretches</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">a</span><span class="p">);</span>
<span class="n">sum</span><span class="p">(</span><span class="n">st</span><span class="p">)</span><span class="o">/</span><span class="n">nnz</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="mf">33.14477077077077</span>
</pre></div>


<h2 id="augmented-spanning-tree-preconditioners">Augmented spanning tree preconditioners</h2>
<p>Here is code that will invoke one.<br />
It is designed for positive definite systems.  So, let's give it one.
Right now, it is using a randomized version of a MST.  There is no real reason to think that this should work.</p>
<div class="codehilite"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">mapweight</span><span class="p">(</span><span class="n">grid2</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="n">x</span><span class="o">-&gt;</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]));</span>
<span class="n">la</span> <span class="o">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">la</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">la</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">la</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="p">@</span><span class="n">time</span> <span class="n">F</span> <span class="o">=</span> <span class="n">augTreeSolver</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="mf">6.529052</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">4.00</span> <span class="n">M</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">1.858</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">15.34</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="p">@</span><span class="n">time</span> <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">29.058915</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">9.74</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">23.209</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">6.84</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>

<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
    <span class="mf">99.74452367765869</span>

<span class="c"># Now, let&#39;s contrast with using CG</span>

<span class="p">@</span><span class="n">time</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cg</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
    <span class="mf">28.719631</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">4.01</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">7.473</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">3.74</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>

<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">3243.6014713600766</span>
</pre></div>


<p>That was not too impressive.  We will have to investigate.  By default, it presently uses randishKruskal.  Let's try randishPrim.  You can pass the treeAlg as a parameter.</p>
<div class="codehilite"><pre><span class="p">@</span><span class="n">time</span> <span class="n">F</span> <span class="o">=</span> <span class="n">augTreeSolver</span><span class="p">(</span><span class="n">la</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">treeAlg</span><span class="o">=</span><span class="n">randishPrim</span><span class="p">);</span>
    <span class="mf">6.319489</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">4.00</span> <span class="n">M</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">2.030</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">18.81</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="p">@</span><span class="n">time</span> <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">29.503484</span> <span class="n">seconds</span> <span class="p">(</span><span class="mf">9.76</span> <span class="n">k</span> <span class="n">allocations</span><span class="p">:</span> <span class="mf">23.268</span> <span class="n">GB</span><span class="p">,</span> <span class="mf">7.31</span><span class="o">%</span> <span class="n">gc</span> <span class="n">time</span><span class="p">)</span>

<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>  
    <span class="mf">99.29610874176991</span>
</pre></div>


<p>To solve systems in a Laplacian, we could wrap it.</p>
<div class="codehilite"><pre><span class="n">n</span> <span class="o">=</span> <span class="mi">40000</span>
<span class="n">la</span> <span class="o">=</span> <span class="n">lap</span><span class="p">(</span><span class="n">randRegular</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">lapWrapSolver</span><span class="p">(</span><span class="n">augTreeSolver</span><span class="p">,</span><span class="n">la</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span><span class="n">maxits</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">norm</span><span class="p">(</span><span class="n">la</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
    <span class="mf">0.00019304778073388</span>
</pre></div>


<p>As you can see, lapWrapSolver can pass tol and maxits arguments to its solver, if they are given to it.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/yinsGraph/" class="btn btn-neutral float-right" title="API"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../yinsGraph/" class="btn btn-neutral" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../yinsGraph/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../api/yinsGraph/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
